 ## [ADR-0] Процесс обсуждения и принятия решений (RFC / ADR)

| | |
| --- | --- |
| **Дата** | 28.11.20XX |
| **Составил** | Игорь Симдянов (Архитектор) |
| **Статус** | принят |
| **Тэги** | Arch |
| **Причина отмены** | |
| **Замещен на** | |

| | |
| --- | --- |
| **Резюме** | Для обсуждения и принятия решения используется RFC. Для фиксации принятых решений по техническим вопросам — ADR.<br>Все RFC публикуются для обсуждения. Не каждый RFC принимается. Не на основе каждого принятого RFC готовится ADR.Все опубликованные ADR считаются принятыми, пока не замещены более новыми. |
| **Проблема** | **Проблема:** отсутствие документации об архитектуре проектов, в связи с чем усложняется вход в проект новых сотрудников, много раз поднимаются вопросы о целесообразности тех или иных принятых ранее решениях.<br><br>**Цели:**<ul><li>устранить практику передачи знаний об архитектурных особенностях продуктов "из уста в уста";</li><li>повысить документируемость принимаемых решений;</li><li>структурировать процесс обсуждения и принятия архитектурных решений.</li></ul>**Задача:** описать процесс обсуждения и принятия архитектурных решений через ведение документации в формате RFC/ADR. |
| **Описание** | **Термины и определения**<br><br>**RFC (Request for Comments)**— рабочий документ для организации обсуждения каких-либо указанных в его содержании вопросов).<br><br>**ADR (Architecture decision records)**— итоговый документ, описывающий принятое решение по указанному архитектурному вопросу.<br><br>**Описание и процессы**<br><br>**RFC**<br><br>1. Для обсуждения и принятия решений используется рабочий документ RFC. Его составление требуется в любых вопросах, требующих широкого обсуждения:<ul><li>вопросы процессуального характера (регламентирования рабочих процессов)</li><li>вопросы принятия рабочей и/или регламентирующей документации</li><li>вопросы технического характера:<ul><li>затрагивающих несколько проектов</li><li>требующих внесения изменений в технологический стек</li><li>дорогие в реализации и/или в откате изменений</li><li>прочие альтернативные вопросы</li></ul></li><li>любые другие спорные вопросы</li></ul>2. Все документы RFC имеют сквозную нумерацию и название<br><br>3. В RFC указывается дата формирования (вынесения на обсуждение) и составитель<br><br>4. В RFC указывается статус документа:<ul><li>**черновик** — документ находится в стадии написания и не подлежит рассмотрению</li><li>**на обсуждении** — документ активно обсуждается</li><li>**отменен** — документ отменен без принятия решения; причина указывается дополнительно</li><li>**принят** — по документу сформировано решение</li><li>**замещен** — в случае, если по указанному вопросу проводилось повторное принятие решения; ссылка на новый RFC указывается дополнительно</li></ul>5. Структура документа RFC (так же дополнительно в прилагаемом шаблоне RFC\_template):<ul><li>Порядковый номер и название документа</li><li>Заметки о документе:<ul><li>дата публикации</li><li>составитель</li><li>статус документа</li><li>тэги (варианты: **PHP, Python, Ruby, DB, JS, Arch**)</li><li>причина отмены (если присвоен статус Отменен)</li><li>ссылка на заменивший документ (если присвоен статус Замещен)</li></ul></li><li>**Резюме** — краткое описание сути документа</li><li>**Проблема, цель, задача** — краткое тезисное введение в проблематику поднимаемого вопроса.</li><li>**Детальное описание** — подробное описание предлагаемого решения вопроса</li><li>**Недостатки** — описание отрицательных сторон предлагаемого решения</li><li>**Альтернативы** — описание альтернатив и причин выбора именно описываемого решения</li><li>**История вопроса** — ссылки на предыдущие решения подобных вопросов, релевантные источники информации по теме, предыдущие реализации / баги / пост-мортемы, утратившие актуальность RFC</li><li>**Вопросы на обсуждение** — вопросы, на которые в первую очередь следует обратить внимание участникам обсуждения</li><li>**Затрагиваемые сервисы** — список сервисов и/или команд, чьи интересы затрагивает обсуждаемый вопрос; на основе данного списка составляется перечень аппруверов решения</li><li>**Кто голосует** — участники, голоса которых учитываются при принятии RFC и перевода его в ADR (детально описывается ниже)</li><li>**Способ утверждения** — как учитываем голоса: единогласно, большинство ЗА, не менее 3 голосов ЗА, в зависимости от величины и занятости группы. В ходе обсуждения можно менять первоначальные требования, но нельзя исключать ответственных по направлению.</li><li>**Обсуждение** — протокол обсуждения на основе наиболее значимых комментариев и записей собраний</li></ul>6. Порядок работы с документом начинается с его составления, регистрации документа в общем перечне RFC, публикации в общедоступном хранилище и публикации ссылки на документ в канале **#netology-it** мессенджера Slack.<br><br>7. Общий перечень RFC требуется для документирования всех проводимых публичных обсуждений, корректности ведения сквозной нумерации, фиксации статусов рассмотренных документов, а так же для быстрой навигации по существующим документам.<br><br>8. Текстовое обсуждение документа проводится в комментариях к сообщению с опубликованной ссылкой в мессенджере Slack, либо в комментариях к самому документу.<br><br>9. Все значимые для принятия решения доводы помещаются в раздел **Обсуждение**, где фиксируется имя, текст, источник и временная метка комментария и прямая ссылка на него. При этом указание прямой ссылки не является заменой остальной информации о комментарии, а лишь подтверждением его существования и точности цитаты. Читатель документа должен за один раз ознакомится со всеми доступными комментарии, а не переключаться между десятками страниц по ссылкам.<br><br>10. Так же, в раздел Обсуждение помещаются резюме всех собраний, проводимых по данному вопросу. Крайне желательно ведение записи собраний и размещение прямой ссылки на них. При этом указание прямой ссылки на запись не является заменой резюме об итогах собрания, а служит для сохранения информации о приводимых доводах в рамках обсуждения указанного вопроса.<br><br>11. По завершению обсуждения в канале **#netology-it** мессенджера Slack проводится голосование о принятии решения вопросам, указанным в документе. В случае отрицательного решения документу присваивается статус Отменен, указывается причина отмены рассмотрения, документ возвращается на доработку составителю и будет повторно рассмотрен под новым номером.<br><br>12. После проведенного голосования вносить какие-либо правки в текст документа запрещается.<br><br>13. Все правки в тексте документа возможны только в статусе черновика; либо в статусе обсуждения, но только в части формы, но не содержания предложенного решения.<br><br>**ADR**<br><br>1. **ADR** оформляется при принятии решений технического характера в следующих случаях:<ul><li>вопросы затрагивают несколько проектов</li><li>требуется внесение изменений в технологический стек</li><li>дорогие в реализации и/или в откате изменений</li><li>требующие финансирования для привлечения сторонних сервисов, программного обеспечения и т.п.</li><li>прочие альтернативные и спорные вопросы</li></ul>2. Структура документа ADR дублирует структуру RFC, который описывается ранее. Более того они создаются копированием принятого RFC-документа.<br><br>3. Все документы ADR имеют сквозную нумерацию и название<br><br>4. В ADR указывается статус документа:<ul><li>**черновик** — документ находится в стадии написания</li><li>**принят** — документ опубликован в публичном доступе</li><li>**замещен** — в случае, если по указанному вопросу проводилось повторное принятие решения; ссылка на новый ADR указывается дополнительно</li></ul>5. Порядок работы с документом начинается с его составления на основе принятого RFC, регистрации ADR, публикации в общедоступном хранилище и публикации ссылки на документ в канале **#netology-it** мессенджера Slack.<br><br>6. Общий перечень ADR требуется для документирования всех принятых архитектурных решений, корректности ведения сквозной нумерации, фиксации статусов документов, а так же для быстрой навигации по существующим документам.<br><br>7. Текст детального описания ADR должен соответствовать Детальному описанию RFC, на основе которого принято решение. Все правки в текст должны вносится на стадии подготовки RFC.<br><br>8. Ожидаемые результаты описываются с целью оценки эффективности применения указанного решения. При этом описываются как положительные, так и отрицательные результаты применения решения. Недостижение указанных результатов, либо выявление неожиданных отрицательных последствий может быть поводом к пересмотру принятого решения, что необходимо явно указать в последующих RFC.<br><br>**Голосование**<br><br>**Кто голосует?**<br>Вопросы, которые выносятся на обсуждение в RFC могут быть очень разными и затрагивать разные технические группы. QA-отдел может выбирать фреймворк для автотестирования, SRE-отдел может принимать решение по выбору технологии проксирования, backend-разработчики договариваться о способах размещения и оформления service-object-ов. Будет странно, если разные группы будут влиять на принимаемые решения. Поэтому при составлении RFC мы явно описываем кто голосует. При этом возможны следующие варианты:<ul><li>группа из определенного стека: Python-разработчики, Ruby-разработчики, SRE, Front-разработка, Архитектурный комитет</li><li>весь отдел Разработки</li><li>сотрудники, принимавшие участие в обсуждении RFC</li></ul>Это не означает, что в ходе обсуждения, это поле не меняется. Состав группы для голосования может быть расширен или сужен, после того, как участники представят свои аргументы. Например, обсуждаем в кругу backend-разработчиков необходимость ElasticSearch, в ходе обсуждения понимаем, что к обсуждению и голосованию нужно подключать SRE-отдел.<br><br>**Есть обязательные участники?**<br><br>Да, по некоторым вопросам, нужно чтобы положительно голосовал ответственный по направлению. . Состав утверждает архитектурный комитет и CTO.<br><br>**Чем грозит голосование за и против?**<br><br>Участие в голосовании за RFC предполагает ответственность:<ul><li>вы ознакомились с содержимым RFC;</li><li>согласны/не согласны и готовы аргументировано представить свою точку зрения;</li><li>вы готовы участвовать в дальнейшей судьбе вынесенной на обсуждение темы. Например, кто-то через год нашел этот RFC и хочет узнать детали и обстоятельства его создания и утверждения. Вам нужно быть готовым участвовать во встрече и поделиться своей аргументацией.</li></ul>Если подготавливается RFC на смену ранее существовавшему RFC, участники голосовавшие за и против предыдущего RFC тоже обязательно приглашаются на обсуждение/голосование за новый вариант.<br><br>**Сколько голосов достаточно, чтобы считать RFC принятым или отклоненным?**<br><br>Составитель RFC указывает в графе "Способ утверждения" один из вариантов, который по его мнению лучше всего использовать для принятия RFC. Например:<ul><li>единогласно;</li><li>большинство ЗА;</li><li>не менее трех голосов ЗА.</li></ul>Такая вольная интерпретация связана с тем, что некоторые отделы не многочисленны. В других сотрудники постоянно заняты и они не могут уделить внимание RFC. Другая группа может наоборот, быть настолько велика, что из-за отпусков всех собрать вместе невозможно: кто-то обязательно в отпуске.<br><br>Выбранный порядок голосования можно изменять в ходе обсуждения.<br><br>По некоторым вопросам обязателен голос ответственного по направлению. |
| **Недостатки** | Система ведения рабочей документации через RFC/ADR может замедлить принятие решений, увеличить сроки по рассмотрению архитектурных вопросов. |
| **Альтернативы** | Не рассматривались |
| **История вопроса** | До RFC/ADR документация и принятые решения фиксировались в нескольких системах. В них можно найти старые договоренности и регламенты:<br><br>Confluence<br>Gitbook<br>Gitlab<br>MIRO<br>Верхнеуровневая архитектура<br> |
| **Вопросы на обсуждение** | 1\. Следует ли принимать данный документ?<br><br>2. Какие причины могут мешать вашему участию в RFC/ADR-движении?<br>Определяем голосованием<br><br>3. Кто принимает решения в рамках отдела "Разработка", в рамках конкретного стека: SRE, Back, Front, QA.<br>Прописываем отдельно в "Правилах игры"<br><br>4. Что нужно изменить в тексте шаблона RFC?<br>Добавляем ответственных по направлениям с правом вето, плюс прописываем чем "грозит" участие в голосовании и обсуждении<br><br>5. Как по вашему следует организовать процесс голосования за принимаемое решение?<br>На усмотрение составителя и комментаторов<br><br>6. Нужно ли перенести RFC/ADR из GoogleDocs в gitlab?<br> Переносим при помощи Coludpress Markdown Converter |
| **Затрагиваемые сервисы** | Отдел разработки (dev, front, mobile, qa) |
| **Кто голосует?** | Архитектурный комитет |
| **Способ утверждения** | Единогласно |
| **Комментарии** | |
| **Собрания** | 14.11.20XX Представление черновика на Архитектурном комитете<br><br>22.11.20XX Обсудили вопросы на Архитектурном комитете, пришли к заключению, что нужны доработки по следующим пунктам:<ul><li>RFC-0 в google.drive, ADR в Gitlab (playbook) — отрабатываем перенос markdown (описываем в правилах игры)</li><li>Прописываем голосование (несколько вариантов, один из которых выбирает составитель, может меняться в процессе обсуждения RFC)</li><li>Прописываем ответственность (какая польза/угроза от участия/не участия — не все заканчивается голосованием, свой голос нужно уметь обосновать)</li><li>Составляем матрицу апрувов (вертикали стеки, горизонтали — вопросы, в ячейках кто обязательно должен апрувить)</li></ul>28.11.20XX. RFC принят на архитектурном комитете и переводится в статус ADR |

| | |
| --- | --- |
| **За** | **Против** |
| Участник1 | |
| Участник2 | |
| Участник3 | |
| Участник4 | |
| Участник5 | |
| Участник6 | |
| Участник7 | |
| Участник8 | |
| Участник9 | |
